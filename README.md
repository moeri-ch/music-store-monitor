# 🎸 5つの楽器店統合監視システム (GitHub Actions版)

5つの楽器店（イケベ楽器店、黒澤楽器店、島村楽器、QSic、J-Guitar）の新商品を毎日自動で監視し、メール通知するシステムです。  
GitHub Actionsを使用して無料でクラウド実行されます。

## ✨ 特徴

- 🕘 **毎日自動実行**: 毎日 日本時間8:00に自動で商品チェック
- 💰 **高価格商品フィルタ**: 10万円以上の商品のみを通知
- 🌟 **特別キーワード検出**: ダブルトップ・ラティス構造の楽器を自動検出
- 🆓 **完全無料**: GitHub Actionsの無料枠を使用
- 📧 **スマートメール通知**: 特別商品の優先表示機能
- 🔒 **セキュア**: 機密情報はGitHub Secretsで安全に管理
- 📱 **PC不要**: クラウドで実行されるためPCの電源状態に依存しない
- 🏪 **5サイト対応**: 複数の楽器店を一括監視
- 🎯 **J-Guitar改良**: 大幅に改善された商品名抽出

## 🎯 対象サイト

1. **イケベ楽器店** - クラシックギター
2. **黒澤楽器店** - クラシックギター  
3. **島村楽器** - クラシックギター
4. **QSic** - クラシックギター
5. **J-Guitar** - クラシックギター（改良版解析）

## 🚀 セットアップ手順

### 1. このリポジトリをFork

右上の「Fork」ボタンをクリックして、自分のアカウントにコピーします。

### 2. GitHub Secretsの設定

**Settings** → **Secrets and variables** → **Actions** → **New repository secret**

以下の5つのSecretを設定してください：

| Secret名 | 説明 | 例 |
|----------|------|---|
| `SMTP_SERVER` | SMTPサーバー | `smtp.gmail.com` |
| `SMTP_PORT` | SMTPポート | `587` |
| `SENDER_EMAIL` | 送信元メールアドレス | `your_email@gmail.com` |
| `SENDER_PASSWORD` | アプリパスワード | `abcd efgh ijkl mnop` |
| `RECIPIENT_EMAIL` | 受信先メールアドレス | `recipient@yahoo.co.jp` |

### 3. Gmailアプリパスワードの取得

1. [Google アカウント管理](https://myaccount.google.com/) にアクセス
2. **セキュリティ** → **2段階認証プロセス** を有効化
3. **アプリパスワード** を生成
4. 生成された16文字のパスワードを `SENDER_PASSWORD` に設定

### 4. 実行確認

**Actions**タブで以下を確認：
- ワークフローが表示されること
- 手動実行（「Run workflow」）が可能なこと
- 毎日の自動実行が設定されていること

## 📅 実行スケジュール

- **自動実行**: 毎日 日本時間 8:00 (UTC 23:00)
- **手動実行**: Actionsタブから随時実行可能

## 📧 通知メール例

### 特別キーワード検出時

```
🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟
🔥 【特別注目商品】ダブルトップ・ラティス構造の商品を発見！ 🔥
🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟

🏪 イケベ楽器店: Juan Hernandez ダブルトップ Classical Guitar (¥280,000)

============================================================

5つの楽器店サイトで高価格新商品 3件を検出しました！
（10万円以上の商品のみ・価格情報付き）

🏪 【イケベ楽器店】 新商品 2件
----------------------------------------

1. 📦 Juan Hernandez ダブルトップ Classical Guitar Model 2024
   💰 ¥280,000 (¥280,000)
   🌟 ダブルトップ/ラティス構造商品
   🔗 https://www.ikebe-gakki.com/ProductDetail.aspx?pid=123456

2. 📦 Gibson Antonio Sanchez Model 1025
   💰 ¥180,000 (¥180,000)
   🔗 https://www.ikebe-gakki.com/ProductDetail.aspx?pid=789012
```

### 通常の通知メール

```
🎸 高価格新商品が5件見つかりました - 5サイト統合監視（毎日・10万円以上のみ） [GitHub Actions]

5つの楽器店サイトで高価格新商品 5件を検出しました！
（10万円以上の商品のみ・価格情報付き）

============================================================

🏪 【黒澤楽器店】 新商品 3件
----------------------------------------

1. 📦 Juan Hernandez Estudio Classical Guitar
   💰 ¥260,000 (¥260,000)
   🔗 https://shop.kurosawagakki.com/items/456789

...
```

## 💰 価格フィルタリング機能

- **10万円以上の商品のみ**をメール通知
- 高価格商品に絞った効率的な監視
- 価格情報を詳細表示（¥xxx,xxx形式）

## 🌟 特別キーワード検出機能

以下のキーワードを検出すると、メール冒頭で特別にハイライト：
- **ダブルトップ** (doubletop)
- **ラティス** (lattice)

これらの構造は高品質なクラシックギターの特徴で、特に注目すべき商品です。

## 🔧 カスタマイズ

### 実行時刻の変更

`.github/workflows/monitor.yml` の cron 設定を変更：

```yaml
schedule:
  # 毎日21:00 JST (12:00 UTC) に変更する場合
  - cron: '0 12 * * *'
```

### 実行頻度の変更

```yaml
schedule:
  # 週1回（土曜日）実行する場合
  - cron: '0 23 * * 6'
  # 月2回（1日と15日）実行する場合  
  - cron: '0 23 1,15 * *'
```

### 価格制限の変更

`music_store_monitor.py` の価格制限を変更：

```python
def is_high_value_product(self, product):
    price_value = self.extract_price_value(product.get('price', ''))
    return price_value >= 200000  # 20万円以上に変更
```

### 特別キーワードの追加

```python
self.special_keywords = [
    'ダブルトップ', 'ラティス', 'doubletop', 'lattice',
    'スプルース', 'ローズウッド'  # 追加例
]
```

## 📊 実行ログの確認

**Actions**タブ → 最新の実行 → **monitor-logs** から以下をダウンロード可能：
- `multi_store_monitor_price_required.log`: 実行ログ
- `multi_store_products_price_required.json`: 商品データ

## 🧪 ローカルテスト

本番実行前にローカルでテストできます：

1. **設定ファイル作成**:
   ```bash
   cp config.json.template config.json
   # config.jsonにメール設定を記入
   ```

2. **依存関係インストール**:
   ```bash
   pip install -r requirements.txt
   ```

3. **テスト実行**:
   ```bash
   python music_store_monitor.py  # 本番と同じ処理
   ```

## ⚠️ 注意事項

- **毎日実行**のため、GitHub Actions使用量が増加します（無料枠内で問題なし）
- **10万円以上フィルタ**により、通知される商品数は減少します
- Gmail以外のメールサービスを使用する場合は、SMTP設定を調整してください
- サイトの構造変更により、商品抽出が正常に動作しない場合があります
- 各サイトへの負荷軽減のため、適切な間隔を空けて実行しています

## 🆘 トラブルシューティング

### メールが送信されない
1. GitHub Secretsの設定を確認
2. Gmailアプリパスワードを再生成
3. Actionsログでエラー内容を確認

### 商品が検出されない
1. 対象サイトのメンテナンス状況を確認
2. サイト構造の変更を確認
3. 手動実行でテスト

### 特定のサイトでエラーが発生
1. Actionsログで詳細なエラー内容を確認
2. そのサイトの構造変更をチェック
3. 必要に応じてスクレイピングロジックを調整

## 📈 改良点（v3.0）

### 🚀 新機能
- **毎日自動実行**: 週1回から毎日実行に変更
- **10万円以上フィルタ**: 高価格商品のみを通知
- **特別キーワード検出**: ダブルトップ・ラティス構造の自動検出
- **改良メール通知**: 特別商品の優先表示

### 🔧 技術的改善
- **J-Guitar解析大幅改善**: より正確な商品名・価格抽出
- **テーブル構造解析**: HTML構造の詳細分析
- **価格抽出強化**: 複数パターンでの価格検出
- **重複除去機能**: 商品名ベースの重複排除

### 🎯 精度向上
- **商品名判定**: ブランド名・ギター用語・年代の総合判定
- **ノイズ除去**: より厳密なノイズテキスト除外
- **エラーハンドリング**: 個別サイトエラーでも継続実行

## 📜 ライセンス

MIT License

## 🤝 コントリビューション

Issue、Pull Request歓迎です！新しい楽器店の追加や機能改善のご提案をお待ちしています。

---

## 🎵 楽器愛好家の皆様へ

このシステムは、クラシックギター愛好家が新しい楽器との出会いを見逃さないために開発されました。特に、ダブルトップやラティス構造などの特別な楽器を見つけた時の喜びを、皆さんと共有できれば幸いです。

素晴らしい楽器との出会いがありますように！🎸✨